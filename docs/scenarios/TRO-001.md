# TRO-001: The Rapid Foothold

- **ID:** TRO-001
- **Category:** Initial Access Simulation / USB HID Emulation
- **MITRE ATT&CK Mapping:** [T1059.001 - Command and Scripting Interpreter: PowerShell](https://attack.mitre.org/techniques/T1059/001/)

---

## ðŸ“– Description

This scenario emulates a fast-acting HID payload delivered via Teensy. Upon insertion, the device automatically triggers a rapid keystroke sequence to open a terminal (PowerShell) and execute a non-destructive command to gather basic system information and write it to a temporary file. This simulates an adversary's first steps after gaining physical access to an unlocked workstation.

## ðŸŽ¯ Attack Objective

The primary objective is to demonstrate the speed of hardware-orchestrated initial execution and to test defender visibility into rapid command-line activity triggered by USB insertion.

## ðŸ‘¥ Threat Model

This aligns with a **Physical Insider Threat** or an **Opportunistic Physical Access** adversary profile (e.g., an unauthorized individual in a shared office space or a technician with malicious intent).

## ðŸ› ï¸ Requirements

- **Hardware:** Teensy 4.0 or 4.1
- **OS Environment:** Windows 10/11 (Target)
- **Prerequisites:** Unlocked workstation, default taskbar configuration.

---

## ðŸ”„ High-Level Flow

1. **Device Insertion:** Teensy is plugged into a USB port.
2. **Enumeration:** The OS identifies the Teensy as a standard HID Keyboard.
3. **Trigger:** After a short delay (allowing for driver initialization), the HID sequence begins.
4. **Action:**
    - `Win+R` to open the "Run" dialog.
    - Types `powershell -NoProfile -ExecutionPolicy Bypass -Command "..."`
    - Prepares a string that collects `whoami`, `hostname`, and `ipconfig` outputs.
5. **Output:** The output is redirected to `$env:TEMP\research.txt`.
6. **Cleanup:** Minimal interaction remains on the screen; the "Run" window closes automatically.

---

## ðŸ“ˆ Detection Surface

### Host-Level Logs

- **Sysmon Event ID 1 (Process Creation):** Look for `powershell.exe` being spawned with unusual command-line arguments (e.g., `-NoProfile`, `-ExecutionPolicy Bypass`).
- **Windows Event ID 4688:** Correlation between a new USB device arrival and immediate `powershell.exe` activity.
- **Windows Event ID 4104 (Script Block Logging):** Captures the exact commands executed within the PowerShell session.

### Device Telemetry

- **SetupAPI.dev.log:** Records the installation/recognition of the new HID device.
- **USBLogView:** Can track the exact timestamp of insertion and the device ID (VID: 16C0, PID: 0482 by default for Teensy).

---

## ðŸ›¡ï¸ Mitigation & Controls

- **Physical Control:** Enforce workstation locking policies (Win+L) and security awareness training.
- **Technical Control:**
  - **USB Device Control:** Implement GPOs to restrict HID device registration to pre-approved VIDs/PIDs (though these can be spoofed).
  - **EDR Rule:** Alert on `powershell.exe` execution within 5-10 seconds of a "New Hardware Device Registered" event.
  - **AppLocker/WDAC:** Restrict PowerShell to "Constrained Language Mode" for non-privileged users.

---

## âš–ï¸ Legal & Ethical Notice
>
> [!IMPORTANT]
> This scenario is purely for validation of detection systems. The command executed is non-destructive and only collects local metadata for research purposes.

---

**Author:** Ismail Tasdelen
**Updated:** 2026-01-01
