# Lab 1: The Visibility Challenge

- **Difficulty:** Level 1 (Introductory)
- **Goal:** Identify the exact log artifacts generated by an HID simulation.

---

## üõ†Ô∏è Environment Setup

- **Victim:** Windows 10/11 VM (Host)
- **Monitoring Tools:**
  - [Sysmon](https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon) (Installed with a standard config like [SwiftOnSecurity](https://github.com/SwiftOnSecurity/sysmon-config)).
  - [USBLogView](https://www.nirsoft.net/utils/usb_log_view.html) or [USBview](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/usbview).
  - Windows Event Viewer.

---

## üß™ Exercise Steps

### 1. Baselining

Before plugging in the device, clear your logs or Note the current timestamp.

- Clear Sysmon Log: `wevtutil cl "Microsoft-Windows-Sysmon/Operational"`
- Clear System Log: `wevtutil cl System`

### 2. The Interaction

Connect a Teensy loaded with the [TRO-001 Payload](../../payloads/TRO-001_RapidFoothold.ino).
Observe the automated execution of the command.

### 3. Investigation

Answer the following questions using your monitoring tools:

- **USB Detection:** What is the exact `DeviceInstanceID` assigned to the Teensy? Use `USBLogView` or the *System* log.
- **Process Creation:** Find the Sysmon Event ID 1 for `powershell.exe`. What was the `ParentProcessId`? (Hint: It should be `explorer.exe` or `svchost.exe` depending on the trigger).
- **Command Line:** What was the full command line captured by Sysmon? Is any part of it truncated or obscured?
- **Speed Audit:** Compare the timestamp of the USB insertion with the timestamp of the first `powershell.exe` execution. What is the delta?

---

## üèÅ Expected Outcome

Creation of a **Sigma Rule** or **Hunt Query** that alerts on:
> "Any instance of powershell.exe spawned within 5 seconds of a HID keyboard device registration."

## üõ°Ô∏è Knowledge Check

- Why is it difficult to distinguish an HID device from a regular keyboard via software alone?
- How does the `VID` and `PID` help or hinder identification?

---

**Lab Maintainer:** Ismail Tasdelen
**Updated:** 2026-01-01
